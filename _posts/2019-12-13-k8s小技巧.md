---
layout:     post
title:      kubectl 技巧s.
subtitle:   kubectl tips.
date:       2019-12-13
author:     Hex
header-img: img/post-bg-unix-linux.jpg
catalog: true
tags:
    - Kubernetes
    - 运维笔记
    - Python
    - Blog
---

## 简化命令行交互, 简化应用程序部署语法

#### 1. Kubectl 自动补全
kubectl 工具本身支持自动补全,只需要简单设置一下即可

````bash
echo "source <(kubectl completion bash)" >> ~/.bashrc

source ~/.bashrc
````
如果没有安装`bash-completion`, 按如下命令安装
```bash
apt update
apt install bash-completion
```

#### 2. 自定义 kubectl get 输出

kubectl get 相关资源，默认输出为 kubectl 内置，一般我们也可以使用`-o json`/`-o jsonpath=''`或者`-o yaml`查看其完整的资源信息。但是很多时候，我们需要关心的信息并不全面，因此我们需要自定义输出的列，那么可以使用 go-template 来进行实现。

go-template 是 golang 的一种模板，可以参考 [template](https://link.zhihu.com/?target=https%3A//golang.org/pkg/text/template/) 的相关说明。

比如仅仅想要查看获取的 pods 中的各个 pod 的 uid，则可以使用以下命令：
````bash
kubectl get pods --all-namespaces -o go-template='{{range .items}}{{.metadata.uid}} {{end}}'
````
比如使用 jsonpath 获取数据
```bash
export ISTIO_PILOT_PORT=$(kubectl get -n istio-system service istio-ingressgateway -o jsonpath='{.spec.ports[?(@.name=="tcp-pilot-grpc-tls")].nodePort}')
echo ${ISTIO_PILOT_PORT}
```


## Reference
[Kubernetes 的奇技淫巧](https://mp.weixin.qq.com/s/G8t18WpE_XW69nRmFLZSfg)
