---
title: Minikube本地启动
categories:
  - Kubernetes
tags:
  - Kubernetes
date: '2020-04-23 09:05:07'
top: false
comments: true
---

# 重要

minikube 主要是镜像都在k8s.gcr.io上，需要设置proxy。

# 环境说明

+ Ubuntu18.04
+ driver = docker

# 安装

### 1. 初始配置

验证机器支持虚拟化。执行下面命令，如果输出非空则说明支持。

```bash
grep -E --color 'vmx|svm' /proc/cpuinfo
```

### 2. 安装minikube

+ 安装配置kubectl

```bash
# 下载最新版本
curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
# 配置
chmod +x ./kubectl
sudo mv ./kubectl /usr/local/bin/kubectl
# 检查安装
kubectl version --client
```

+ 

+ 安装minikube

```bash
# 下载最新版本
curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 
# 配置
chmod +x minikube
sudo install minikube /usr/local/bin/
# 检查安装
minikube start --driver=docker
minikube status
```



# 使用

+ 启动

由于在Ubuntu下，参数`--image-mirror-country=cn`存在bug，所以通过`image-repository`指定阿里的源进行安装。

参数说明：

| 参数               | 参数说明                                                     | 值                                                           |
| ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| --driver           | 常用值说明：<br> virtualbx--使用virtualbox<br>vmware--使用vmware<br>none: 在主机上而不是在虚拟机中运行Kubernetes组件。您需要运行Linux并安装Docker。<br>docker: Docker驱动程序允许您将Kubernetes安装到现有的Docker安装中。在Linux上，这并不需要启用虚拟化。<br>podman: 在PodMan中运行k8s组件。需要安装podman. | 使用"docker"，注意一些访问权限的问题。和[局限性](https://minikube.sigs.k8s.io/docs/drivers/docker/#known-issues) |
| --registry-mirror  | 手动启动dockerd时，通过--registry-mirror选项，或编辑/etc/docker/daemon.json并添加Registry-mirrors键和值，以使更改持久化。 | "https://registry.docker-cn.com"国内registry-mirror          |
| --image-repository | 对gcr.io的访问权限有限时，指定拉取镜像的地址。例如registry.cn-hangzhou.aliyuncs.com/google_containers | registry.cn-hangzhou.aliyuncs.com/google_containers          |



```bash
minikube start --driver=docker --registry-mirror=https://registry.docker-cn.com --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
```

+ 停止

```bash
minikube stop
```

+ 删除（清除本地数据）

```bash
minikube delete
```



# Reference



# 备注

[install minikube](https://kubernetes.io/docs/tasks/tools/install-minikube/)

[Installing Kubernetes with Minikube](https://kubernetes.io/docs/setup/learning-environment/minikube/#specifying-the-vm-driver)

[minikube启动带参数`--image-mirror-country=cn`失败](https://github.com/kubernetes/minikube/issues/7052)

[Minikube 安装踩坑记](https://www.jianshu.com/p/48804c8bb250)

也可以考虑ubuntu出的[microk8s](https://microk8s.io/)

